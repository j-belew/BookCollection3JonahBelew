env:RUBY_VERSION: 3.1.2POSTGRES_USER: postgresPOSTGRES_PASSWORD: passwordDATABASE_USER: postgresDATABASE_PASSWORD: passwordname: Rails testson: [push, pull_request]jobs:rspec-test:name: RSpecruns-on: ubuntu-latestservices:postgres:image: postgres:12ports:- 5432:5432env:POSTGRES_USER: ${{ env.POSTGRES_USER }}POSTGRES_PASSWORD: ${{ env.POSTGRES_PASSWORD }}steps:- uses: actions/checkout@v2- uses: ruby/setup-ruby@v1with:ruby-version: ${{ env.RUBY_VERSION }}- name: Install postgres clientrun: sudo apt-get install libpq-dev- name: Install dependenciesrun: |gem install bundlerbundler install- name: Create databaserun: |bundler exec rails db:create RAILS_ENV=testbundler exec rails db:migrate RAILS_ENV=test- uses: borales/actions-yarn@v3.0.0with:cmd: install- name: Run testsrun: bundler exec rspec .- name: Run brakemanrun: brakeman -o brakeman.txt- name: Run rubocoprun: bundler exec rubocop --force-exclusion vendor/*/** --out rubocop.txt
- name: Upload coverage resultsuses: actions/upload-artifact@masterif: always()with:name: coverage-reportpath: coverage- name: Upload rubocop reportuses: actions/upload-artifact@masterif: always()with:name: rubocop-report.txtpath: rubocop.txt- name: Upload brakeman reportuses: actions/upload-artifact@masterif: always()with:name: brakeman-report.txtpath: brakeman.txt
